---
layer: single
title: "유니티 RPG - 37. 공격판정 구현"
categories: Unity
tag: [C#, Unity, project]
toc: true
author_profile: false
sidebar: 
    nav: "docs"
---

# Intro

이번 포스팅은 플레이어의 공격 애니메이션에 맞게 공격판정을 구현해보았습니다.

공격 판정을 구현하는 방법은 여러가지가있습니다.

1. Raycast 활용
2. Collider 활용
3. Overlap 활용
4. Projectile 활용

전략패턴으로 무기를 만들어놓았으니, 각 무기마다 적절한 방법을 적용할 수 있습니다.

오늘은 검 공격판정을 만들기위해 BoxCollider를 사용해서 애니메이션 이벤트를 통해 애니메이션과 공격판정을 동기화해보았습니다.


## Sword 

먼저, 만들어두었던 무기 프리팹에 BoxCollider 컴포넌트를 추가해주고, Trigger 체크 및 비활성화 해두었습니다.

그런다음 Sword 클래스에서 공격판정을 위한 함수를 구현합니다.

```c#
/*
                    Sword : 무기(검) 클래스

            - BoxCollider를 사용해서 공격판정 구현
            
 */
public class Sword : Weapon
{
    private BoxCollider hitBox;                 // 공격 판정

    private void Awake()
    {
        // 무기 타입 설정
        type = WeaponType.Sword;

        hitBox = GetComponent<BoxCollider>();
    }

    // 공격 데미지 등
    public override void Attack()
    {
        Debug.Log("몬스터 공격성공");
    }

    protected override void OnTriggerEnter(Collider other)
    {
        if(other.CompareTag("Monster"))
        {
            Attack();
        }
    }
    public override void SetHitBox(bool isEnabled)
    {
        hitBox.enabled = isEnabled;
    }
}
```
<br>

* 콜라이더의 Trigger 옵션을 통해 공격의 성공여부를 판단할것이므로 OntriggerEnter를 사용했습니다.

* SetHitBox()는 애니메이션 이벤트를 사용하기위한 함수로, PlayerController 클래스에서 호출합니다.


## PlayerController

플레이어에 Animator가 있으므로 애니메이션 이벤트에 Sword의 SetHitbox() 를 활용할 수 없습니다.

따라서 PlayerController에서 Sword의 함수를 접근할 수 있는 메서드를 만들어주었습니다.

```c#
    private void EnableHitbox()
    {
        WeaponManager.Instance.currentWeapon.SetHitBox(true);
    }

    private void DisableHitbox()
    {
        WeaponManager.Instance.currentWeapon.SetHitBox(false);
    }
```

이 메서드들을 애니메이션의 적절한 타이밍에 이벤트함수로 호출합니다.

![image](/images/2025/2025-02-17/capture_1.gif) 


