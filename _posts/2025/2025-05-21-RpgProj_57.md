---
layer: single
title: "유니티 RPG - 57. 프로젝트 요약"
categories: Unity
tag: [C#, Unity, project]
toc: true
author_profile: false
sidebar: 
    nav: "docs"
---


# 프로젝트 개요

* **게임개요**
    - 1인 개발 프로젝트
    - 개발기간 : 2024.10.13 ~ (실제 개발 약 2개월반)
    - 장르 : 백뷰 형식 3D RPG
    - [Github 주소](https://github.com/CodenameUS/Sample-Project/tree/main)
<br>

* **기술스택**
    - Unity 2021 LTS
    - C#, JSON
<br>

* **프로젝트 주요 목표**
    - RPG 게임의 핵심 기능 구현(재미, 게임성 고려X)
    - 최적화된 클라이언트 시스템 설계
    - 유지보수와 확장성을 고려한 객체지향적 설계
<br>

* **플레이 영상**
<iframe width="1905" height="784" src="https://www.youtube.com/embed/2SktU-gIqG8" title="게임 플레이영상" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

<br>

## 게임 플레이

게임 플로우는 다음과 같습니다.

![image](/images/2025/2025-05-21/capture_1.PNG)

<br>

* **PersistentScene**

![image](/images/2025/2025-05-21/capture_2.PNG)

<u>PersistentScene</u>에는 "게임 전반에 걸쳐 유지되어야하는 오브젝트들"이 존재합니다.

이 씬은 게임을 플레이하는동안에 **Unload** 되지않으며, 다른 씬들을 **Additive** 모드로 로드하여 이 씬에 존재하는 객체들에 접근할 수 있도록 하였습니다.

플레이어, 카메라, 여러 UI와 매니저 클래스들이 해당되며, 초기화작업을 거친뒤 ViliageScene를 로드합니다.

<br>

* **ViliageScene**

![image](/images/2025/2025-05-21/capture_3.PNG)

<u>ViliageScene</u>은 플레이어가 게임을 시작할 때 보게되는 가장 첫 씬입니다.

상점 NPC가 존재하며, 전투에 필요한 여러 아이템을 구매할 수 있습니다.

포탈을 통해 던전에 입장할 수 있습니다.

<br>

* **LoadingScene**

![image](/images/2025/2025-05-21/capture_4.PNG)

<u>LoadingScene</u>은 플레이어가 다른맵으로 이동할 때 다음 씬이 로드되는동안 보여지는 로딩씬입니다.

현재 로딩상태를 보여주는 로딩바와, 게임팁을 출력합니다.

<br>

* **DungeonScene**

![image](/images/2025/2025-05-21/capture_5.PNG)

<u>DungeonScene</u>은 플레이어가 몬스터와의 전투가 이루어지는 공간입니다.

잡몹을 모두 처치하면 보스몬스터가 소환되며, 모든 몬스터를 처치하게되면 보상과함께 마을로 돌아갈 수 있는 포탈이 생성됩니다.

<br>

## 주요 시스템

프로젝트에서 구현한 주요 시스템은 다음과같습니다.

* 인벤토리
    - 아이템 설계
    - 퀵슬롯(인벤토리 연계)
    - 캐릭터 정보창(인벤토리 연계)
<br>

* 전투 시스템
    - 몬스터 AI
    - 플레이어 
<br>

* 데이터 관리
    - JSON 데이터 Load & Save
    - 플레이어, 아이템, 인벤토리 등의 데이터 관리
<br>

* 기타
    - UI
    - 게임의 성능 향상을 위한 최적화
    - 여러가지 매니저 클래스
<br>    

### 인벤토리

---

<iframe width="1905" height="784" src="https://www.youtube.com/embed/PBW-3Wpx4EU" title="인벤토리 소개" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

<br>

인벤토리 시스템의 구조는 다음과 같습니다.

![image](/images/2025/2025-05-21/capture_6.PNG)

<br>

* **Inventory** : 인벤토리내의 아이템 데이터를 배열로 관리하고, 인벤토리의 실질적인 동작을 처리합니다.
    - 아이템의 추가(습득), 스왑, 사용, 제거 등
    - [Code](https://github.com/CodenameUS/Sample-Project/blob/main/Assets/Scripts/UI/Inventory/Inventory.cs)
* **InventoryUI** : 인벤토리내의 마우스 이벤트와 모든 아이템 슬롯을 관리합니다.
    - 인벤토리의 아이템 슬롯을 배치 및 생성합니다.
    - 마우스 클릭, 드래그 앤 드롭을 구현하여 인벤토리내 UI와 상호작용할 수 있도록 했습니다.
    - 인벤토리의 아이템 슬롯 정보들을 리스트로 관리합니다.
    - [Code](https://github.com/CodenameUS/Sample-Project/blob/main/Assets/Scripts/UI/Inventory/InventoryUI.cs)
* **ItemSlotUI** : 각 아이템 슬롯의 데이터를 관리하고, 슬롯에서 발생하는 기능들을 구현합니다.
    - 슬롯의 인덱스, 아이템 이미지, 아이템 텍스트 등의 데이터
    - 아이템 이미지의 표시, 강조효과 등의 기능 구현
    - 이미지는 ResourceManager를 통해 Addressable 에셋을 Load하여 표시
    - [Code](https://github.com/CodenameUS/Sample-Project/blob/main/Assets/Scripts/UI/Inventory/ItemSlotUI.cs)

<br>

--- 

인벤토리 시스템은 크게 위 3가지로 구성되어있습니다.

**ItemSlotUI**는 **InventoryUI**가 관리하며, **Inventory**는 **InventoryUI**와 상호작용합니다.

실제 아이템 객체 **Item**은 **Inventory**가 관리하고 있기때문에 **ItemSlotUI**의 **Item** 상태 공유는 **InventoryUI**, **Inventory**에 의해 간접적으로 이루어집니다.

즉, 인벤토리내에서 이벤트(새로운 아이템이 추가되는등의)가 발생하면 **InventoryUI**를 참조해 UI를 갱신하고

UI에서 사용자 이벤트가 발생했을 때는 **InventoryUI**가 **Inventory**를 참조하여 아이템 또는 아이템배열을 갱신합니다.
<br>

[인벤토리 UI와 관련된 코드](https://github.com/CodenameUS/Sample-Project/tree/main/Assets/Scripts/UI/Inventory)


#### 아이템

--- 

RPG에서 아이템의 종류는 매우 다양하고, 아이템 마다의 특징이 존재합니다.

따라서 아이템을 설계할 때 쉽게 새로운 종류의 아이템을 추가하고 관리할 수 있도록

유지보수성과 확장을 고려한 객체지향적 아이템 구조를 설계하였습니다.

![image](/images/2025/2025-05-21/capture_7.PNG)

- 아이템의 데이터를 공통적인 부분은 묶고, 세부적인 부분은 분리하여 상속을 통해 새로운 아이템 추가가 쉽도록 하였습니다.
    - ex. 포션아이템
        - Id, Name 등은 ItemData에 작성
        - 아이템 수량(Amount) 등은 CountableItemData에 작성
        - 회복량 등은 PortionItemData에 작성

- 또한 **데이터 부분과 기능 부분을 분리**하여 유지보수가 쉽도록 하였습니다.
    - ItemData 계층은 데이터 구조
    - Item 계층은 게임 내 동작(로직)

<br>

프로젝트에서는 크게 두가지 종류의 아이템을 구현하였습니다.

1. **장비아이템**(EquipmentItem)
    - 장비아이템은 슬롯 한칸에 하나의 아이템만 존재할 수 있습니다.
    - 장비아이템에는 세부적으로 무기와 방어구 아이템이 있습니다.
    - "IEquipableItem" 인터페이스 상속으로 아이템의 장착/해제를 구현합니다.

2. **수량이 있는 아이템**(CountableItem)
    - 수량이 있는 아이템은 슬롯 한칸에 여러개의 아이템이 존재할 수 있습니다.
    - 수량이 있는 아이템은 몬스터의 <u>전리품, 물약, 주문서</u> 등이 있습니다.
    - 수량이 있는 아이템중에서도 **사용이 가능한** 아이템은 "IUsableItem" 인터페이스 상속으로 사용이 가능한 아이템(PortionItem)을 구현하였습니다.

---

아이템 생성의 전체적인 흐름은 다음과 같습니다.

1. JSON 파일로 작성되어있는 데이터를 "**DataManager**"가 Load 합니다.

2. DTO 클래스는 JSON 데이터를 직/역직렬화할 때 사용됩니다.

3. **DataManager**는 각 DTO로 ItemData 를 생성하고, 딕셔너리에 캐싱해둡니다.
    - 이후 추가적인 로딩없이 재사용할 수 있고, 게임 전역에서 데이터를 쉽게 참조할 수 있도록 하였습니다.

4. 아이템이 생성되어야할 때, 캐싱되어있는 데이터를 가지고 아이템을 생성합니다.


이러한 설계방식을 통해 유지보수가 쉽고, 확장성이 높은 객체 지향 기반의 아이템 시스템을 구현하였습니다.

[Item 관련 Code](https://github.com/CodenameUS/Sample-Project/tree/main/Assets/Scripts/Item)

[ItemData 관련 Code](https://github.com/CodenameUS/Sample-Project/tree/main/Assets/Scripts/ItemData)

<br>

#### 퀵슬롯

---

퀵슬롯은 인벤토리에서 드래그앤드롭을 통해 아이템을 등록하고 빠르게 사용할 수 있도록하는 UI입니다.

![image](/images/2025/2025-05-21/capture_10.PNG)


- 물약아이템만 등록이 가능합니다.

- 숫자키 (1,2,3,4) 입력을 통해 아이템을 사용할 수 있습니다.

---

* **PlayerItemGroupUI** : 모든 퀵 슬롯 데이터를 관리합니다.
    - Inventory와 상호작용하며 아이템 등록, 사용, 제거를 수행합니다.
    - 키 입력을 처리합니다.

* **PlayerItemSlotUI** : 각 슬롯의 데이터를 관리합니다.
    - 슬롯에 등록된 아이템의 이미지와 텍스트를 표시하고 제거합니다.
    - 슬롯에 등록된 아이템의 사용을 요청합니다.

--- 

퀵 슬롯에 아이템을 등록하고 사용하는 과정은 다음과 같습니다.

![image](/images/2025/2025-05-21/capture_11.PNG)

1. InventoryUI에서 마우스 이벤트(퀵슬롯에 아이템 등록)가 발생하여 Inventory에 이벤트 처리를 요청합니다.

2. Inventory에서 PlayerItemGroupUI에 등록하려는 아이템 데이터를 공유합니다.

3. 넘겨받은 데이터로 PlayerItemSlotUI에 아이템 등록을 요청합니다.

4. 아이템 아이콘 및 텍스트를 표시합니다.

5. 입력이 발생하면 해당 슬롯에 아이템 사용을 요청하고, 슬롯에서 Inventory에 아이템의 사용을 요청합니다.

6. 만약 아이템 사용이벤트가 발생하면 인벤토리와 퀵슬롯의 아이템상태를 갱신합니다


#### 캐릭터정보창

--- 

캐릭터 정보창은 플레이어가 장착한 장비와 현재 능력치를 확인할 수 있는 UI 입니다.

![image](/images/2025/2025-05-21/capture_8.PNG)

<br>

- UI의 왼쪽부분은 플레이어가 장착한 장비슬롯이 있습니다.
    - 슬롯에 커서를 올리면 강조효과 + 아이템 툴팁이 출력됩니다.
    - 슬롯을 우클릭하면 장착중이던 장비를 해제할 수 있습니다.

- UI의 오른쪽부분은 플레이어의 능력치가 표시됩니다.
    - 현재체력, 공격력, 방어력 등의 능력치가 표시되며 장비 및 스킬로 인한 증가치가 합산되어 표시됩니다.

---

캐릭터 정보창은 인벤토리 코드를 재사용하여 구현하였습니다.

* **EquipmentUI** : 장비슬롯의 데이터들을 관리하고, 마우스이벤트를 구현합니다.
    - Inventory 와 상호작용하며, 장비 슬롯에 아이템을 등록 및 제거합니다.
    - 장비 장착등의 이벤트가 발생하면 현재 상태를 저장합니다.

* **EquipmentSlotUI** : 각 장비슬롯의 데이터를 관리하고, 슬롯에서 발생하는 기능을 구현합니다.
    - 슬롯의 인덱스, 아이템 이미지등의 데이터
    - 아이템 이미지의 표시, 강조효과 등의 기능 구현
    - 이미지는 ResourceManager를 통해 Addressable 에셋을 Load하여 표시

--- 

캐릭터 정보창에 아이템을 등록하는 과정은 다음과 같습니다.

![image](/images/2025/2025-05-21/capture_9.PNG)

1. InventoryUI에서 마우스 이벤트(장비아이템 사용)가 발생하여 Inventory에 이벤트 처리를 요청합니다.
    
2. Inventory에서 아이템 사용을 처리하고, EquipmentUI에 장착한 아이템 데이터를 넘겨줍니다.
    - 장비 아이템 장착에 따른 능력치 처리는 아이템 객체의 Equip(), UnEquip() 에서 처리합니다.

3. 넘겨받은 데이터로 슬롯에 아이템데이터를 저장하고, EquipmentSlotUI에서 아이템 이미지를 등록합니다.

4. 반대로 장비의 해제는 EquipmentUI에서 마우스 이벤트를 처리하고, Inventory에 후처리를 요청합니다.
    - 해제한 아이템은 인벤토리에 추가됩니다.


### 전투 시스템

전투 시스템은 크게 플레이어와 몬스터 부분으로 나뉩니다.

- 플레이어
    - 플레이어 무기 시스템
    - 플레이어 스킬 시스템

- 몬스터
    - 몬스터 AI


#### 플레이어 

---

플레이어 기본 조작은 다음과 같습니다.

- 플레이어는 키보드 방향키로 움직일 수 있습니다.
- 플레이어는 'C' 키 입력으로 기본 공격을 할 수 있습니다.
- 플레이어는 'A', 'S', 'D' 키 입력으로 스킬 공격을 할 수 있습니다

<br>

플레이어는 현재 장착중인 무기에따라 무기 프리팹을 생성하여 손에 들고있도록 하였습니다.

무기의 타입은 다음과 같습니다.

1. None : 무기를 장착하고 있지 않음.
    - 무기를 장착하고 있지 않을때는 주먹 공격을 수행
2. Sword 
3. Staff
4. Bow : 공격은 현재 미구현

<br>

무기의 실제 공격판정은 두가지 방식으로 구현하였습니다.

1. Raycast 
2. Collider 

검 공격과 같이 몬스터와 직접 부딪힐 때 공격판정을 발생시킬때는 Collider 방식으로 구현하였습니다.

<br>

무기의 설계 방식은 다음과 같습니다.

