---
layer: single
title: "유니티 RPG - 47. 콤보어택(기본공격)"
categories: Unity
tag: [C#, Unity, project]
toc: true
author_profile: false
sidebar: 
    nav: "docs"
---


# Intro

이번 포스팅에서는 예전에 만들었다 삭제한 콤보공격을 구현해보았습니다.

이번에는 코루틴을 사용하기보다는 애니메이션 이벤트로 처리해보려고 노력했습니다.

<br>

우선, 애니메이션의 Transition 에 대하여 이해가 필요했습니다.

![image](/images/2025/2025-04-08/capture_1.PNG)


공격키 입력을 통해 Attack 트리거를 발동시키면, Attack 애니메이션이 실행됩니다.
<br>

![image](/images/2025/2025-04-08/capture_2.PNG)

플레이어가 장착하고있는 무기에따라 WeaponType 가 결정되고, 네가지 공격 애니메이션 중 하나가 실행되는것까지 되어있는 상태입니다.

여기에 **ComboCount** 파라미터를 만들어 Attack_LeftPunch => Attack_RightPunch 로의 Transition 을 위한 조건을 달아주어야합니다.

![image](/images/2025/2025-04-08/capture_4.PNG)

<br>

현재 공격이 진행되는 순서입니다.

![image](/images/2025/2025-04-08/capture_3.PNG)

- 공격키(C) 입력을 통해 PlayerController 클래스의 Attack() 함수가 호출됩니다.
    - PlayerController.Attack() 함수는 단순히 "Attack" 트리거를 발동시켜 공격 애니메이션을 실행하도록 합니다.

- 실행되는 애니메이션은 애니메이션 이벤트를 통해 특정 타이밍에 PlayerController.TriggerAttack() 함수가 호출됩니다.
    - PlayerController.TriggerAttack() 함수는 **Weapon** 클래스의 Attack() 즉, **Punch** 클래스의 Attack() 를 호출하여 공격판정을 실행합니다.


## 구상

먼저 기본공격에 콤보공격을 추가하려고합니다.



PlayerController 에서 처리를할 수도 있지만, 그것보다 콤보공격이 가능한 무기만이 필요한 처리이므로 무기클래스에서 처리하도록 하였습니다.

또한 PlayerController 에서는 애니메이션의 처리와 애니메이션 이벤트를 처리할 수 있도록 하였습니다.

<br>


### Punch 클래스

네가지 무기중 기본공격 클래스인 Punch 클래스에 콤보공격을 가능하도록 해보았습니다.

```c#
// Punch.cs
    private int maxComboCount = 1;

    // 공격 판정
    public override void Attack()
    {
        SetComboCount();

        attackOrigin = GameManager.Instance.player.transform.position + GameManager.Instance.player.transform.up;
        attackDir = GameManager.Instance.player.transform.forward;
        

        RaycastHit[] hits = Physics.BoxCastAll(
            attackOrigin,                       // 중심위치 : 플레이어
            boxSize,                            // 박스크기
            attackDir,                          // 공격방향     
            Quaternion.identity,                // 회전X
            attackRange,                        // 공격최대거리
            LayerMask.GetMask("Monster")
            );
        
        // 한마리만 공격
        if(hits.Length > 0)
        {
            Monster monster = hits[0].collider.GetComponent<Monster>();
            if (monster != null)
            {
                monster.GetDamaged(DataManager.Instance.GetPlayerData().Damage);
            }
        }
    }

    // ComboCount 설정
    private void SetComboCount()
    {
        if (GameManager.Instance.player.CurComboCount < maxComboCount)
            GameManager.Instance.player.CurComboCount++;
        else
            GameManager.Instance.player.CurComboCount = 0;
    }
```

- 기본공격은 왼손 -> 오른손 의 콤보공격이 있습니다. 
    - 따라서 maxComboCount = 1

- SetComboCount() : 